# 权利要求书

1. 一种基于混合协议的大规模文件分发方法，其特征在于，包括：

通过控制服务器创建中继任务和分发任务，并将所述中继任务和分发任务持久化存储至数据库中；
所述控制服务器将所述分发任务下发至多个客户端，并将所述中继任务下发至至少一个中继服务器；
所述中继服务器从数据源服务器拉取目标文件，在拉取过程中同时提供HTTP协议和BitTorrent协议的数据下载服务；
所述客户端根据分发配置，与所述中继服务器及其他客户端组成BitTorrent下载网络进行数据下载，当BitTorrent协议下载速度低于预设阈值时，自动切换至HTTP协议进行辅助下载；
所述控制服务器配置全局下载参数并向所述客户端动态分配配额，实现对数据源服务器的压力精细化控制。

2. 根据权利要求1所述的方法，其特征在于，所述全局下载参数包括全局下载并发数、全局下载带宽和全局下载总流量中的至少一种。

3. 根据权利要求1所述的方法，其特征在于，所述中继服务器位于IDC机房、云平台或CDN边缘节点上，支持同时为多个客户端提供HTTP协议和BitTorrent协议的数据下载服务。

4. 根据权利要求1所述的方法，其特征在于，所述客户端自动切换至HTTP协议进行辅助下载的步骤包括：

实时监测当前BitTorrent协议下载速度；
当监测到下载速度低于预设阈值时，向中继服务器或数据源服务器发起HTTP协议下载请求；
通过HTTP协议下载部分数据块作为BitTorrent协议的补充。

5. 根据权利要求4所述的方法，其特征在于，所述预设阈值根据文件大小、网络环境类型和分发规模中的至少一种因素进行动态调整。

6. 根据权利要求1所述的方法，其特征在于，所述控制服务器对数据源服务器的压力精细化控制包括：

配置全局下载参数，包括最大并发连接数、带宽限制和流量限制；
根据客户端数量和分布情况，向各客户端分配下载配额；
实时监控数据源服务器的负载情况，动态调整配额分配策略。

7. 根据权利要求1所述的方法，其特征在于，所述中继服务器在拉取目标文件的过程中同时提供数据下载服务的步骤包括：

接收客户端的下载请求；
从数据源服务器流式拉取文件数据；
在接收到文件数据的同时，将已接收的数据转发给请求下载的客户端。

8. 根据权利要求7所述的方法，其特征在于，所述流式拉取文件数据采用缓冲机制，当缓冲区中的数据量达到预设阈值时开始向客户端提供数据服务。

9. 根据权利要求1所述的方法，其特征在于，还包括：

所述控制服务器根据客户端的地理位置、网络类型和历史下载记录中的至少一种，智能选择最优的中继服务器组合；
为中继服务器配置负载均衡策略，确保各中继服务器的负载均衡。

10. 根据权利要求1所述的方法，其特征在于，还包括：

客户端下载完成后，自动转换为种子节点，为其他客户端提供数据上传服务；
根据网络环境和带宽情况，动态调整上传带宽分配。

11. 根据权利要求1所述的方法，其特征在于，所述分发配置包括优先下载文件块、下载线程数、最大下载速度和超时设置中的至少一种参数。

12. 根据权利要求1所述的方法，其特征在于，还包括：

所述控制服务器实时收集各客户端的下载状态信息；
根据下载状态信息生成统计报表；
基于统计报表优化分发策略和参数配置。

13. 一种基于混合协议的大规模文件分发装置，其特征在于，包括：

任务创建单元，用于创建中继任务和分发任务；
任务下发单元，用于将分发任务下发至多个客户端，并将中继任务下发至至少一个中继服务器；
文件拉取单元，用于从中继服务器从数据源服务器拉取目标文件，在拉取过程中同时提供HTTP协议和BitTorrent协议的数据下载服务；
混合下载单元，用于根据分发配置，与中继服务器及其他客户端组成BitTorrent下载网络进行数据下载，当BitTorrent协议下载速度低于预设阈值时，自动切换至HTTP协议进行辅助下载；
压力控制单元，用于配置全局下载参数并向客户端动态分配配额，实现对数据源服务器的压力精细化控制。

14. 根据权利要求13所述的装置，其特征在于，所述压力控制单元包括：

参数配置模块，用于配置全局下载并发数、全局下载带宽和全局下载总流量；
配额分配模块，用于根据客户端数量和分布情况，向各客户端分配下载配额；
动态调整模块，用于实时监控数据源服务器的负载情况，动态调整配额分配策略。

15. 根据权利要求13所述的装置，其特征在于，所述混合下载单元包括：

速度监测模块，用于实时监测当前BitTorrent协议下载速度；
协议切换模块，当监测到下载速度低于预设阈值时，向中继服务器或数据源服务器发起HTTP协议下载请求；
数据补充模块，通过HTTP协议下载部分数据块作为BitTorrent协议的补充。

16. 根据权利要求13所述的装置，其特征在于，所述文件拉取单元包括：

流式拉取模块，用于从数据源服务器流式拉取文件数据；
数据转发模块，在接收到文件数据的同时，将已接收的数据转发给请求下载的客户端；
缓冲管理模块，采用缓冲机制管理数据流，当缓冲区中的数据量达到预设阈值时开始向客户端提供数据服务。

17. 根据权利要求13所述的装置，其特征在于，还包括：

智能选择单元，用于根据客户端的地理位置、网络类型和历史下载记录中的至少一种，智能选择最优的中继服务器组合；
负载均衡单元，用于为中继服务器配置负载均衡策略，确保各中继服务器的负载均衡。

18. 根据权利要求13所述的装置，其特征在于，还包括：

种子转换单元，用于在客户端下载完成后，自动转换为种子节点，为其他客户端提供数据上传服务；
带宽调整单元，用于根据网络环境和带宽情况，动态调整上传带宽分配。

19. 一种电子设备，包括处理器、存储器以及存储在所述存储器上并可在所述处理器上运行的计算机程序，所述处理器执行所述计算机程序时实现如权利要求1至12中任一项所述的基于混合协议的大规模文件分发方法。

20. 一种计算机可读存储介质，其上存储有计算机程序，所述计算机程序被处理器执行时实现如权利要求1至12中任一项所述的基于混合协议的大规模文件分发方法。