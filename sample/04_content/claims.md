# 權利要求書

1. 一種基於混合協議的大規模文件分發方法，其特徵在於，包括：

通過控制服務器創建中繼任務和分發任務，並將所述中繼任務和分發任務持久化存儲至數據庫中；
所述控制服務器將所述分發任務下發至多個客戶端，並將所述中繼任務下發至至少一箇中繼服務器；
所述中繼服務器從數據源服務器拉取目標文件，在拉取過程中同時提供HTTP協議和BitTorrent協議的數據下載服務；
所述客戶端根據分發配置，與所述中繼服務器及其他客戶端組成BitTorrent下載網絡進行數據下載，當BitTorrent協議下載速度低於預設閾值時，自動切換至HTTP協議進行輔助下載；
所述控制服務器配置全局下載參數並向所述客戶端動態分配配額，實現對數據源服務器的壓力精細化控制。

2. 根據權利要求1所述的方法，其特徵在於，所述全局下載參數包括全局下載併發數、全局下載帶寬和全局下載總流量中的至少一種。

3. 根據權利要求1所述的方法，其特徵在於，所述中繼服務器位於IDC機房、雲平臺或CDN邊緣節點上，支持同時爲多個客戶端提供HTTP協議和BitTorrent協議的數據下載服務。

4. 根據權利要求1所述的方法，其特徵在於，所述客戶端自動切換至HTTP協議進行輔助下載的步驟包括：

實時監測當前BitTorrent協議下載速度；
當監測到下載速度低於預設閾值時，向中繼服務器或數據源服務器發起HTTP協議下載請求；
通過HTTP協議下載部分數據塊作爲BitTorrent協議的補充。

5. 根據權利要求4所述的方法，其特徵在於，所述預設閾值根據文件大小、網絡環境類型和分發規模中的至少一種因素進行動態調整。

6. 根據權利要求1所述的方法，其特徵在於，所述控制服務器對數據源服務器的壓力精細化控制包括：

配置全局下載參數，包括最大併發連接數、帶寬限制和流量限制；
根據客戶端數量和分佈情況，向各客戶端分配下載配額；
實時監控數據源服務器的負載情況，動態調整配額分配策略。

7. 根據權利要求1所述的方法，其特徵在於，所述中繼服務器在拉取目標文件的過程中同時提供數據下載服務的步驟包括：

接收客戶端的下載請求；
從數據源服務器流式拉取文件數據；
在接收到文件數據的同時，將已接收的數據轉發給請求下載的客戶端。

8. 根據權利要求7所述的方法，其特徵在於，所述流式拉取文件數據採用緩衝機制，當緩衝區中的數據量達到預設閾值時開始向客戶端提供數據服務。

9. 根據權利要求1所述的方法，其特徵在於，還包括：

所述控制服務器根據客戶端的地理位置、網絡類型和歷史下載記錄中的至少一種，智能選擇最優的中繼服務器組合；
爲中繼服務器配置負載均衡策略，確保各中繼服務器的負載均衡。

10. 根據權利要求1所述的方法，其特徵在於，還包括：

客戶端下載完成後，自動轉換爲種子節點，爲其他客戶端提供數據上傳服務；
根據網絡環境和帶寬情況，動態調整上傳帶寬分配。

11. 根據權利要求1所述的方法，其特徵在於，所述分發配置包括優先下載文件塊、下載線程數、最大下載速度和超時設置中的至少一種參數。

12. 根據權利要求1所述的方法，其特徵在於，還包括：

所述控制服務器實時收集各客戶端的下載狀態信息；
根據下載狀態信息生成統計報表；
基於統計報表優化分發策略和參數配置。

13. 一種基於混合協議的大規模文件分發裝置，其特徵在於，包括：

任務創建單元，用於創建中繼任務和分發任務；
任務下發單元，用於將分發任務下發至多個客戶端，並將中繼任務下發至至少一箇中繼服務器；
文件拉取單元，用於從中繼服務器從數據源服務器拉取目標文件，在拉取過程中同時提供HTTP協議和BitTorrent協議的數據下載服務；
混合下載單元，用於根據分發配置，與中繼服務器及其他客戶端組成BitTorrent下載網絡進行數據下載，當BitTorrent協議下載速度低於預設閾值時，自動切換至HTTP協議進行輔助下載；
壓力控制單元，用於配置全局下載參數並向客戶端動態分配配額，實現對數據源服務器的壓力精細化控制。

14. 根據權利要求13所述的裝置，其特徵在於，所述壓力控制單元包括：

參數配置模塊，用於配置全局下載併發數、全局下載帶寬和全局下載總流量；
配額分配模塊，用於根據客戶端數量和分佈情況，向各客戶端分配下載配額；
動態調整模塊，用於實時監控數據源服務器的負載情況，動態調整配額分配策略。

15. 根據權利要求13所述的裝置，其特徵在於，所述混合下載單元包括：

速度監測模塊，用於實時監測當前BitTorrent協議下載速度；
協議切換模塊，當監測到下載速度低於預設閾值時，向中繼服務器或數據源服務器發起HTTP協議下載請求；
數據補充模塊，通過HTTP協議下載部分數據塊作爲BitTorrent協議的補充。

16. 根據權利要求13所述的裝置，其特徵在於，所述文件拉取單元包括：

流式拉取模塊，用於從數據源服務器流式拉取文件數據；
數據轉發模塊，在接收到文件數據的同時，將已接收的數據轉發給請求下載的客戶端；
緩衝管理模塊，採用緩衝機制管理數據流，當緩衝區中的數據量達到預設閾值時開始向客戶端提供數據服務。

17. 根據權利要求13所述的裝置，其特徵在於，還包括：

智能選擇單元，用於根據客戶端的地理位置、網絡類型和歷史下載記錄中的至少一種，智能選擇最優的中繼服務器組合；
負載均衡單元，用於爲中繼服務器配置負載均衡策略，確保各中繼服務器的負載均衡。

18. 根據權利要求13所述的裝置，其特徵在於，還包括：

種子轉換單元，用於在客戶端下載完成後，自動轉換爲種子節點，爲其他客戶端提供數據上傳服務；
帶寬調整單元，用於根據網絡環境和帶寬情況，動態調整上傳帶寬分配。

19. 一種電子設備，包括處理器、存儲器以及存儲在所述存儲器上並可在所述處理器上運行的計算機程序，所述處理器執行所述計算機程序時實現如權利要求1至12中任一項所述的基於混合協議的大規模文件分發方法。

20. 一種計算機可讀存儲介質，其上存儲有計算機程序，所述計算機程序被處理器執行時實現如權利要求1至12中任一項所述的基於混合協議的大規模文件分發方法。